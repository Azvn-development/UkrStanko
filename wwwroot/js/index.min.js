"use strict";function hideDropDownMenu(e){var t=$(e.target).parent(".header-dropdown-toggle");$(".header-dropdown-toggle").is(e.target)||$(t).hasClass("header-dropdown-toggle")||($(".header-dropdown-toggle").removeClass("open"),$(".header-dropdown-list").removeClass("open"))}function showDropDownMenu(e,t){$(".header-dropdown-toggle").removeClass("open"),$(".header-dropdown-list").removeClass("open"),$(e).addClass("open"),$(t).addClass("open")}function showDialog(e){$("body").css("overflow","hidden"),$(e).css("display","flex")}function hideDialog(){$(".dialog-modal").css("display","none"),$("body").css("overflow","auto")}function clearMessageDialog(e,t){$(e).val(""),$(t).attr("hidden",!0),$(t).children("div").each(function(e,t){return $(t).html("")}),$(t).children("input").each(function(e,t){return $(t).val("")})}function clearFilterDialog(e,t){$(e).each(function(e,t){return $(t).val("")}),$(t).each(function(e,t){return $(t).prop("checked",!1)})}function searchElements(e,t){13===e.keyCode&&$.ajax({url:t,beforeSend:function(){$("#waiting-modal").fadeIn("fast")},complete:function(){$("#waiting-modal").fadeOut("fast")},data:{searchString:$(e.target).val(),startDate:$("#startDate").val(),endDate:$("#endDate").val(),ownRecords:$("#ownRecords").prop("checked")},success:function(e){fillData(e)}})}function filterElements(e){$.ajax({url:e,data:{searchString:$("#Search").val(),startDate:$("#startDate").val(),endDate:$("#endDate").val(),ownRecords:$("#ownRecords").prop("checked")},success:function(e){activeFilterButton(),fillData(e)}})}function sendMessage(e){var t=$("#messageText").val();0<t.length&&$.ajax({url:e,beforeSend:function(){$("#waiting-modal").fadeIn("fast")},complete:function(){$("#waiting-modal").fadeOut("fast")},data:{text:t,responseId:$("#responseId").val(),responseType:$("#responseType").val(),connectionId:sessionStorage.getItem("connectionId")},success:function(e){fillData(e)}})}function deleteElement(e,t){var n=$(e.target);$.ajax({url:t,beforeSend:function(){$("#waiting-modal").fadeIn("fast")},complete:function(){$("#waiting-modal").fadeOut("fast")},data:{id:n.attr("id"),searchString:$("#Search").val(),startDate:$("#startDate").val(),endDate:$("#endDate").val(),ownRecords:$("#ownRecords").prop("checked"),connectionId:sessionStorage.getItem("connectionId"),details:n.attr("details")},success:function(e){1==e?($(n.attr("data-containerId")).remove(),n.removeAttr("data-containerId")):0!=e&&("true"===n.attr("details")?fillData(e,"#main-data"):fillData(e))}})}function activeFilterButton(){var e=$(".fa-filter");""==$("#startDate").val()&&""==$("#endDate").val()&&0==$("#ownRecords").prop("checked")?e.removeClass("open"):e.addClass("open")}function fillData(e,t){null!=t?$(t).html(e):$("#data").html(e,t)}function goHistoryBack(e){sessionStorage.setItem("historyBack",!0),sessionStorage.setItem("currentUrl",e),sessionStorage.removeItem("previousUrl"),window.history.back()}function goToUrl(e,t,n){if("true"==sessionStorage.getItem("historyBack")){if(checkForm(t))return void window.history.back();if(checkSameUrl(t))return void window.history.back()}$.ajax({url:t,data:{ajaxLoad:!0,connectionId:sessionStorage.getItem("connectionId"),previousUrl:e},beforeSend:function(){$("#waiting-modal").fadeIn("fast")},complete:function(){$("#waiting-modal").fadeOut("fast")},success:function(e){n||window.history.pushState(null,null,t),sessionStorage.removeItem("historyBack"),sessionStorage.removeItem("currentUrl"),$("#main-data").html(e)}})}function checkForm(e){return e.includes("Create")||e.includes("Edit")}function checkSameUrl(e){var t=sessionStorage.getItem("currentUrl");return null!=t&&t==e}function checkCurrentUrl(e){checkForm(window.location.href)&&window.history.pushState(null,null,e)}function saveUrl(e){e.includes("Create")||e.includes("Edit")||sessionStorage.setItem("previousUrl",e)}function getSavedUrl(e){var t=sessionStorage.getItem("previousUrl");null!=t&&(e.val(t),sessionStorage.removeItem("previousUrl"))}function setHubConnection(){var e=(new signalR.HubConnectionBuilder).withUrl("/chat").build();e.on("Error",function(e){var t=$("#pop-up-message");t.removeClass("success"),t.addClass("error"),t.children("i").attr("class","fa fa-2x fa-exclamation-triangle"),t.children("p").html(e),t.show(),setTimeout(function(){t.fadeOut("slow")},3e3)}),e.on("Success",function(e){var t=$("#pop-up-message");t.removeClass("error"),t.addClass("success"),t.children("i").attr("class","fa fa-2x fa-check-circle"),t.children("p").html(e),t.show(),setTimeout(function(){t.fadeOut("slow")},3e3)}),e.start().then(function(){return sessionStorage.setItem("connectionId",e.connectionId)})}function checkField(e,t){null==e.item&&$(t).val("")}function analogsAutocomplete(a,o,r,t,n){null!=r&&$(a).autocomplete({appendTo:$(a).parent(),source:r.filter(function(e){return e.id!=n&&e.machineType.parentMachineType.name==t}).map(function(e){return e.name}),change:function(e,t){var n;checkField(t,a),null!=t.item&&(n=r.filter(function(e){return e.name==t.item.value}),$(o).val(n[0].machineTypeId))}})}function machineTypesAutocomplete(n,a,o,r,e,i){null!=e&&$(n).autocomplete({appendTo:$(n).parent(),source:e.map(function(e){return e.name}),change:function(e,t){checkField(t,n),$(a).val(""),$(o).val(0),null!=t.item&&analogsAutocomplete(a,o,r,t.item.value,i)}})}function userRolesAutocomplete(n,e){null!=e&&$(n).autocomplete({appendTo:$(n).parent(),source:e.map(function(e){return e.name}),change:function(e,t){checkField(t,n)}})}function validateRange(e,t,n){e=e.replace(",",".");return this.optional(t)||e>=n[0]&&e<=n[1]}function validateNumber(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:[\s\.,]\d{3})+)(?:[\.,]\d+)?$/.test(e)}function scrollToFirstNewNotice(){var e,t,n=$(".first-new-notice");void 0!==n.offset()?(t=$(window).scrollTop())+(e=$(window).height())<=(n=Math.ceil(n.offset().top))&&(t=n-e-t-20,$("html, body").scrollTop(t)):$("html, body").scrollTop($("main").outerHeight())}function checkNoticeShow(e){var t,n,a,o,r=$(".first-new-notice");void 0!==r.offset()&&(t=$(window).scrollTop(),n=$(window).height(),a=Math.floor(r.offset().top),o=Math.floor(r.outerHeight()),a<=t+n&&t+n-2*o<=a+(n-o)&&(r.removeClass("new-notice"),r.removeClass("first-new-notice"),$(".info").children(".new-notice").first().addClass("first-new-notice"),saveNewReadedNoticesCounter(),sendNewReadedNoticesCounter(e)))}function saveStartReadedNoticesCounter(e){sessionStorage.setItem("startReadedNoticesCounter",e),sessionStorage.removeItem("currentReadedNoticesCounter")}function saveNewReadedNoticesCounter(){var e=sessionStorage.getItem("currentReadedNoticesCounter");null!=e||(e=sessionStorage.getItem("startReadedNoticesCounter")),sessionStorage.setItem("currentReadedNoticesCounter",++e)}function sendNewReadedNoticesCounter(e){var t=sessionStorage.getItem("startReadedNoticesCounter"),n=sessionStorage.getItem("currentReadedNoticesCounter");null!=t&&null!=n&&t!=n&&$.ajax({url:e,data:{readedNoticeCouter:n},success:function(e){sessionStorage.setItem("startReadedNoticesCounter",e)}})}function downloadItems(e,t,n,a){var o=$("#downloadItemsContainer");$.ajax({url:e,data:{downloadedCount:n},beforeSend:function(){$("#downloadItemsText").hide(),$("#downloadItemsWheel").show()},complete:function(){$("#downloadItemsWheel").hide(),$("#downloadItemsText").show()},success:function(e){a?($(t).prepend(e),scrollToDownloadItemsContainer(o)):$(t).append(e),o.remove()}})}function scrollToDownloadItemsContainer(e){var t,n;void 0!==e.offset()?(n=$(window).scrollTop())+(t=$(window).height())<=(e=Math.ceil(e.offset().top))&&(n=e-t-n,$("html, body").scrollTop(n)):$("html, body").scrollTop($("main").outerHeight())}function downloadImages(e,t,a){deleteImageLiHandler(),e.click(function(){t.trigger("click"),t.change(function(e){var t=e.target.files;if(0<t.length)for(var n=0;n<t.length;n++)resizeListImage(t[n],a);e.target.value=""})})}function resizeListImage(e,a){var o=document.createElement("canvas"),r=o.getContext("2d"),i=document.createElement("img");i.onload=function(){var e=i.width,t=i.height,n=i.width/i.height,e=e,t=t,t=i.width>i.height?(e=1e3)/n:(e=600*n,600);o.width=e,o.height=t,r.drawImage(i,0,0,e,t);t=o.toDataURL("image/jpeg",.95);a.append(createImageLi(i,t))},i.src=URL.createObjectURL(e)}function createImageLi(e,t){var n=document.createElement("li"),a=document.createElement("i");$(a).attr("name","deleteImageButton"),$(a).addClass("fa fa-minus-square fa-2x icon-cancel");var o=document.createElement("textarea");return $(o).attr("id","Images"),$(o).attr("name","Images"),$(o).attr("hidden",!0),$(o).val(t),n.append(e),n.append(a),n.append(o),n}function deleteImageLiHandler(){$("body").delegate("[name='deleteImageButton']","click",function(){$(this).parents("li").remove()})}function downloadImage(n,t,a){deleteImageContainerHandler(a),n.click(function(e){$("[name='deleteImageButton']").is(e.target)||(t.trigger("click"),t.change(function(e){var t=e.target.files;0<t.length&&(resizeImage(t[0],n),null!=a&&a.val(""),e.target.value="")}))})}function resizeImage(e,a){var o=document.createElement("canvas"),r=o.getContext("2d"),i=document.createElement("img");i.onload=function(){var e=i.width,t=i.height,n=i.width/i.height,e=e,t=t,t=i.width>i.height?(e=1e3)/n:(e=450*n,450);o.width=e,o.height=t,r.drawImage(i,0,0,e,t);t=o.toDataURL("image/jpeg",.9);createImageContainer(a,i,t)},i.src=URL.createObjectURL(e)}function createImageContainer(e,t,n){e.css("background","url("+t.src+") 50% 50% no-repeat"),e.css("background-size","cover"),e.addClass("active");t=document.getElementById("Image");null!=t?$(t).val(n):(t=document.createElement("textarea"),$(t).attr("id","Image"),$(t).attr("name","Image"),$(t).attr("hidden",!0),$(t).val(n),e.append(t))}function deleteImageContainerHandler(e){$("body").delegate("[name='deleteImageButton']","click",function(){null!=e&&e.val(""),$(this).parents("div").removeClass("active"),$(this).parents("div").removeAttr("style")})}